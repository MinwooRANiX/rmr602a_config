<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Wi-Fi 설정</title>
<style>
  body{font-family:system-ui;margin:0;background:#f6f7fb;color:#111}
  .container{max-width:480px;margin:44px auto;padding:22px;background:#fff;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,0.08)}
  h1{font-size:18px;margin:0 0 12px}
  .row{display:flex;align-items:center;gap:10px;margin-top:12px}
  .cb{width:18px;height:18px}
  label.field{min-width:90px}
  input[type="text"],input[type="password"],input[type="number"]{
    flex:1;padding:10px;border:1px solid #ddd;border-radius:8px;box-sizing:border-box
  }
  input[type="number"]:disabled{
    background:#e5e7eb;color:#6b7280;border:1px solid #d1d5db;cursor:not-allowed;
  }
  .actions{display:flex;gap:8px;margin-top:16px}
  button{padding:10px 14px;border:0;border-radius:10px;background:#2563eb;color:#fff;font-weight:700;cursor:pointer}
  .adminLine{margin-top:16px;display:flex;align-items:center;justify-content:space-between}
  .adminLink{background:transparent;border:0;color:#6b7280;cursor:pointer;font-size:12px;padding:0}
  .adminState{font-size:12px;color:#6b7280}
  .adminState.on{color:#065f46;font-weight:800}
  .status{margin-top:14px;display:none}
  .badge{font-size:12px;font-weight:700;padding:6px 10px;border-radius:999px;display:inline-block}
  .ok{background:#ecfdf5;color:#065f46}
  .err{background:#fef2f2;color:#991b1b}
  .wait{background:#eff6ff;color:#1d4ed8}
</style>
</head>

<body>
<div class="container">
  <h1>Wi-Fi 설정</h1>

  <div class="row">
    <input id="cb_ssid" class="cb" type="checkbox" checked />
    <label class="field">SSID</label>
    <input id="ssid" type="text" autocomplete="off" autocapitalize="off" spellcheck="false">
  </div>

  <div class="row">
    <input id="cb_pw" class="cb" type="checkbox" checked />
    <label class="field">Password</label>
    <input id="pw" type="password" autocomplete="off" autocapitalize="off" spellcheck="false">
  </div>

  <div class="row">
    <label class="field">Cluster</label>
    <input id="cluster" type="number" min="0" max="2" step="1" inputmode="numeric" disabled>
  </div>

  <div class="adminLine">
    <button id="adminBtn" class="adminLink" type="button">고급 설정(관리자)</button>
    <span id="adminState" class="adminState">OFF</span>
  </div>

  <div class="actions">
    <button id="sendBtn" type="button">요청 전송</button>
  </div>

  <div id="status" class="status">
    <span id="badge" class="badge wait">대기중</span>
  </div>
</div>

<script>
const DEVICE_COMMAND="http://192.168.4.1/command";
const ADMIN_PASSWORD="12345679";
const LS_KEY="rmr602a_cfg_final";

const ssid=document.getElementById("ssid");
const pw=document.getElementById("pw");
const cluster=document.getElementById("cluster");
const cbSsid=document.getElementById("cb_ssid");
const cbPw=document.getElementById("cb_pw");
const sendBtn=document.getElementById("sendBtn");
const badge=document.getElementById("badge");
const status=document.getElementById("status");
const adminBtn=document.getElementById("adminBtn");
const adminState=document.getElementById("adminState");

let adminEnabled=false;

function saveState(){
localStorage.setItem(LS_KEY,JSON.stringify({
ssid:ssid.value,
pw:pw.value,
cluster:cluster.value,
cbSsid:cbSsid.checked,
cbPw:cbPw.checked,
adminEnabled:adminEnabled
}));
}

function loadState(){
const raw=localStorage.getItem(LS_KEY);
if(!raw)return;
const s=JSON.parse(raw);
ssid.value=s.ssid||"";
pw.value=s.pw||"";
cluster.value=s.cluster||"";
cbSsid.checked=s.cbSsid??true;
cbPw.checked=s.cbPw??true;
adminEnabled=s.adminEnabled??false;
updateAdmin();
}

function updateAdmin(){
if(adminEnabled){
adminState.textContent="ON";
adminState.className="adminState on";
cluster.disabled=false;
}else{
adminState.textContent="OFF";
adminState.className="adminState";
cluster.disabled=true;
cluster.value="";
}
saveState();
}

adminBtn.onclick=function(){
const p=prompt("관리자 비밀번호");
if(p===ADMIN_PASSWORD){
adminEnabled=true;
updateAdmin();
}else{
alert("비밀번호 오류");
}
};

function buildUrl(){
const params=[];
if(cbSsid.checked&&ssid.value.trim()!=="")
params.push("ssid="+encodeURIComponent(ssid.value.trim()));
if(cbPw.checked)
params.push("pw="+encodeURIComponent(pw.value));
if(adminEnabled&&cluster.value!=="")
params.push("cluster="+encodeURIComponent(cluster.value));
if(params.length===0)return null;
return DEVICE_COMMAND+"?"+params.join("&");
}

function setBadge(type,text){
status.style.display="block";
badge.className="badge "+type;
badge.textContent=text;
}

sendBtn.onclick=function(){
saveState();
const url=buildUrl();
if(!url){setBadge("err","전송값 없음");return;}
setBadge("wait","전송중...");
window.open(url,"_blank");
setTimeout(()=>{setBadge("ok","전송 요청 완료");},300);
};

document.querySelectorAll("input").forEach(el=>{
["input","change","blur","keyup"].forEach(e=>el.addEventListener(e,saveState));
});

document.addEventListener("DOMContentLoaded",loadState);
window.addEventListener("pageshow",loadState);
</script>
</body>
</html>
