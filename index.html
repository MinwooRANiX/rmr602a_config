<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Wi-Fi 설정 페이지</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;margin:0;background:#f6f7fb;color:#111}
    .container{max-width:480px;margin:44px auto;padding:22px;background:white;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,0.08);position:relative}
    h1{font-size:18px;margin:0 0 12px}
    .row{display:flex;align-items:center;gap:10px;margin-top:12px}
    .cb{width:18px;height:18px}
    label.field{min-width:110px}
    input[type="text"],input[type="password"]{flex:1;padding:10px;border:1px solid #ddd;border-radius:8px}
    .actions{display:flex;gap:8px;margin-top:16px;flex-wrap:wrap}
    button{padding:10px 14px;border:0;border-radius:10px;background:#2563eb;color:#fff;font-weight:700;cursor:pointer}
    button.alt{background:#10b981}
    .result{margin-top:12px;padding:10px;background:#f3f4f6;border-radius:8px;font-family:monospace;word-break:break-all;display:none}
    .hint{font-size:12px;color:#666;margin-top:8px}
  </style>
</head>
<body>
  <div class="container" role="main">
    <div class="lang-switch" aria-label="언어 선택 / Language select">
      <button type="button" class="lang-btn active" data-lang="ko">KR</button>
      <button type="button" class="lang-btn" data-lang="en">EN</button>
    </div>

    <h1>Wi-Fi 설정</h1>

    <div class="row">
      <input id="cb_ssid" class="cb" type="checkbox" checked />
      <label class="field" for="ssid">Wi-Fi SSID</label>
      <input id="ssid" type="text" placeholder="예: RANIX_WIFI_SSID" />
    </div>

    <div class="row">
      <input id="cb_pw" class="cb" type="checkbox" checked />
      <label class="field" for="pw">Wi-Fi Password</label>
      <input id="pw" type="password" placeholder="예: RANIX_WIFI_PASSWORD" />
    </div>

    <div class="actions">
      <button id="sendBtn">요청 전송</button>
      <button id="buildBtn" class="alt">요청 URL 미리보기</button>
      <button id="copyBtn" style="background:#6b7280">복사</button>
    </div>

    <div class="hint">체크된 항목만 URL에 포함됩니다.</div>
    <div id="result" class="result"></div>
  </div>

  <script>
    const cbSsid = document.getElementById('cb_ssid');
    const cbPw   = document.getElementById('cb_pw');
    const ssidInput = document.getElementById('ssid');
    const pwInput   = document.getElementById('pw');
    const sendBtn  = document.getElementById('sendBtn');
    const buildBtn = document.getElementById('buildBtn');
    const copyBtn  = document.getElementById('copyBtn');
    const result   = document.getElementById('result');
    const heading  = document.querySelector('h1');
    const labelSsid = document.querySelector('label[for="ssid"]');
    const labelPw   = document.querySelector('label[for="pw"]');
    const hintEl    = document.querySelector('.hint');
    const langButtons = document.querySelectorAll('.lang-btn');

    let currentLang = 'ko';

    const langTexts = {
      ko: {
        title: 'Wi-Fi 설정 페이지',
        heading: 'Wi-Fi 설정',
        ssidLabel: 'Wi-Fi SSID',
        ssidPh: '예: RANIX_WIFI_SSID',
        pwLabel: 'Wi-Fi Password',
        pwPh: '예: RANIX_WIFI_PASSWORD',
        send: '요청 전송',
        build: '요청 URL 미리보기',
        copy: '복사',
        copied: '복사됨',
        hint: '체크된 항목만 URL에 포함됩니다.',
        copyFail: '복사 실패 — 권한 확인'
      },
      en: {
        title: 'Wi-Fi Setup Page',
        heading: 'Wi-Fi Setup',
        ssidLabel: 'Wi-Fi SSID',
        ssidPh: 'ex: RANIX_WIFI_SSID',
        pwLabel: 'Wi-Fi Password',
        pwPh: 'ex: RANIX_WIFI_PASSWORD',
        send: 'Send Request',
        build: 'Preview Request URL',
        copy: 'Copy',
        copied: 'Copied',
        hint: 'Only checked fields are included in the URL.',
        copyFail: 'Copy failed — please check permission'
      }
    };

    function applyLang(lang){
      const t = langTexts[lang] || langTexts.ko;
      currentLang = lang;

      document.documentElement.lang = lang;
      document.title = t.title;
      heading.textContent = t.heading;
      labelSsid.textContent = t.ssidLabel;
      labelPw.textContent   = t.pwLabel;
      ssidInput.placeholder = t.ssidPh;
      pwInput.placeholder   = t.pwPh;
      sendBtn.textContent   = t.send;
      buildBtn.textContent  = t.build;
      // 복사 버튼은 상태에 따라 달라지므로, 기본 텍스트만 설정
      copyBtn.textContent   = t.copy;
      hintEl.textContent    = t.hint;
    }

    // 언어 버튼 클릭 처리
    langButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        const lang = btn.dataset.lang;
        applyLang(lang);
        langButtons.forEach(b => b.classList.toggle('active', b === btn));
      });
    });

    function e(v){ return encodeURIComponent(v ?? ''); }

    // ✅ 체크된 항목만 포함 (해제된 항목은 완전히 생략)
    function buildDeviceUrl() {
      const base = 'http://192.168.4.1/command';
      const params = [];
      if (cbSsid.checked) params.push('ssid=' + e(ssidInput.value.trim()));
      if (cbPw.checked)   params.push('pw='   + e(pwInput.value));
      return params.length ? `${base}?${params.join('&')}` : base;
    }

    buildBtn.addEventListener('click', () => {
      const u = buildDeviceUrl();
      result.style.display = 'block';
      result.textContent = u;
    });

    copyBtn.addEventListener('click', () => {
      const u = buildDeviceUrl();
      navigator.clipboard.writeText(u).then(()=>{
        copyBtn.textContent = langTexts[currentLang].copied;
        setTimeout(()=>copyBtn.textContent = langTexts[currentLang].copy,1200);
      }).catch(()=> alert(langTexts[currentLang].copyFail));
    });

    sendBtn.addEventListener('click', () => {
      const url = buildDeviceUrl();
      window.location.href = url;
    });

    // QR로 기본값 전달 가능 (?ssid=...&pw=...)
    (function fillFromQuery(){
      const p = new URLSearchParams(location.search);
      if(p.has('ssid')) ssidInput.value = p.get('ssid');
      if(p.has('pw'))   pwInput.value   = p.get('pw');
    })();

    // 초기 언어 적용 (기본: 한국어)
    applyLang(currentLang);
  </script>
</body>
</html>

